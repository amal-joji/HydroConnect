<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Water Services</title>
  <!-- Razorpay Checkout Script -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <!-- Leaflet CSS for Route Tracker -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    /* Global Styles with Gradient Background */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #74ABE2, #5563DE);
      margin: 0;
      padding: 0;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #fff;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
    }
    /* Tabs Navigation */
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .tab {
      padding: 15px 25px;
      background: #fff;
      border: none;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.3s, transform 0.2s;
    }
    .tab.active, .tab:hover {
      background: #5563DE;
      color: #fff;
      transform: translateY(-2px);
    }
    /* Tab Content Styling */
    .tab-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: none;
      margin-bottom: 20px;
    }
    .tab-content.active {
      display: block;
    }
    /* Form Styling */
    form label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    form input, form select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    form button {
      width: 100%;
      padding: 12px;
      background: #5563DE;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    form button:hover {
      background: #3c4ab2;
    }
    /* Sample Cost Section Styling */
    #paymentAmount {
      font-size: 1.8em;
      color: #ff9800;
      margin: 15px 0;
    }
    #payButton {
      padding: 10px 20px;
      background: #ff9800;
      border: none;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #payButton:hover {
      background: #e68a00;
    }
    /* Table Styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table th, table td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    table th {
      background: #5563DE;
      color: #fff;
    }
    /* Route Tracker Specific Styling */
    #route #map {
      width: 100%;
      height: 500px;
      margin-top: 10px;
    }
    #route #controls {
      margin: 10px;
    }
    #route input, #route button {
      padding: 8px;
      margin: 5px;
    }
    #route #status {
      margin-top: 10px;
      font-weight: bold;
    }
    #route #directions {
      text-align: left;
      max-width: 500px;
      margin: 20px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>HydroConnect - Empowering Community, One Drop at a Time</h1>
  <div class="container">
    <!-- Tabs Navigation -->
    <div class="tab-container">
      <button class="tab active" onclick="openTab(event, 'payment')">Sample Cost</button>
      <button class="tab" onclick="openTab(event, 'prediction')">Water Prediction</button>
      <button class="tab" onclick="openTab(event, 'data')">Sample Data</button>
      <button class="tab" onclick="openTab(event, 'order')">Order Water Tanker</button>
      <button class="tab" onclick="openTab(event, 'route'); initRouteTracker();">Route Tracker</button>
    </div>
    <!-- Sample Cost Tab -->
    <div id="payment" class="tab-content active">
      <h2>Sample Cost Calculator</h2>
      <form id="paymentForm">
        <label for="liters">Enter Water (Liters):</label>
        <input type="number" id="liters" min="1" required>
        <label for="distance">Enter Distance (km):</label>
        <input type="number" id="distance" min="0" required>
        <button type="submit">Calculate Sample Cost</button>
      </form>
      <p id="paymentAmount">₹0</p>
      <button id="payButton" style="display: none;">Pay Now</button>
    </div>
    <!-- Water Prediction Tab -->
    <div id="prediction" class="tab-content">
      <h2>Predict Water Availability</h2>
      <label for="city">Select City:</label>
      <select id="city">
        <option value="Mumbai">Mumbai</option>
        <option value="Delhi">Delhi</option>
        <option value="Bangalore">Bangalore</option>
        <option value="Hyderabad">Hyderabad</option>
        <option value="Chennai">Chennai</option>
        <option value="Kolkata">Kolkata</option>
        <option value="Pune">Pune</option>
        <option value="Ahmedabad">Ahmedabad</option>
        <option value="Jaipur">Jaipur</option>
        <option value="Lucknow">Lucknow</option>
      </select>
      <button onclick="predictWater()">Predict</button>
      <p id="predictionResult" style="font-size: 1.2em; margin-top: 15px;"></p>
    </div>
    <!-- Sample Data Tab -->
    <div id="data" class="tab-content">
      <h2>Sample Data (Major Indian Cities)</h2>
      <table>
        <thead>
          <tr>
            <th>City</th>
            <th>Rainfall (mm)</th>
            <th>Temperature (°C)</th>
            <th>Population Growth (%)</th>
            <th>Water Availability (liters)</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </div>
    <!-- Order Water Tanker Tab -->
    <div id="order" class="tab-content">
      <h2>Order a Water Tanker</h2>
      <form action="/order" method="POST">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <label for="phone">Phone:</label>
        <input type="text" id="phone" name="phone" required>
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required>
        <label for="cityOrder">City:</label>
        <select id="cityOrder" name="city">
          <option value="Mumbai">Mumbai</option>
          <option value="Delhi">Delhi</option>
          <option value="Bangalore">Bangalore</option>
          <option value="Hyderabad">Hyderabad</option>
          <option value="Chennai">Chennai</option>
          <option value="Kolkata">Kolkata</option>
          <option value="Pune">Pune</option>
          <option value="Ahmedabad">Ahmedabad</option>
          <option value="Jaipur">Jaipur</option>
          <option value="Lucknow">Lucknow</option>
        </select>
        <label for="amount">Amount (liters):</label>
        <input type="number" id="amount" name="amount" required>
        <label for="date">Date:</label>
        <input type="text" id="date" name="date" placeholder="YYYY-MM-DD" required>
        <label for="time">Time:</label>
        <input type="text" id="time" name="time" placeholder="HH:MM" required>
        <button type="submit">Place Order</button>
        <script>
            function placeOrder() {
                alert("Order placed successfully!");
            }
        </script>
      </form>
      <h3>OR CALL 70926 00000 & PLACE YOUR ORDER</h3>
    </div>
    <!-- Route Tracker Tab -->
    <div id="route" class="tab-content">
      <h2>Truck Navigation with Turn-by-Turn Directions</h2>
      <div id="controls">
        <input type="text" id="destination" placeholder="Enter Destination (e.g., Taj Mahal)" />
        <button onclick="setDestination()">Set Destination</button>
      </div>
      <div id="map"></div>
      <p id="status">Waiting for GPS signal...</p>
      <div id="directions"><strong>Directions:</strong> <ul id="directionList"></ul></div>
    </div>
  </div>
  <!-- Scripts -->
  <!-- Leaflet JS for Route Tracker -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    /* ================================
       Water Services & Sample Data Code
    ================================ */
    let sampleData = [];

    function openTab(evt, tabName) {
      const tabs = document.querySelectorAll('.tab-content');
      tabs.forEach((tab) => tab.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      const tabButtons = document.querySelectorAll('.tab');
      tabButtons.forEach((btn) => btn.classList.remove('active'));
      evt.currentTarget.classList.add('active');
    }
  
    function populateTable(data) {
      const dataTable = document.getElementById('data-table');
      dataTable.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.City}</td>
                        <td>${row.Rainfall}</td>
                        <td>${row.Temperature}</td>
                        <td>${row.Population_Growth}</td>
                        <td>${row.Water_Availability}</td>`;
        dataTable.appendChild(tr);
      });
    }
  
    function getFallbackData() {
      return [
        { City: 'Mumbai', Rainfall: 220, Temperature: 30, Population_Growth: 1.5, Water_Availability: 4000 },
        { City: 'Delhi', Rainfall: 150, Temperature: 35, Population_Growth: 2.0, Water_Availability: 3500 },
        { City: 'Bangalore', Rainfall: 180, Temperature: 28, Population_Growth: 1.2, Water_Availability: 4200 },
        { City: 'Hyderabad', Rainfall: 170, Temperature: 32, Population_Growth: 1.8, Water_Availability: 3800 },
        { City: 'Chennai', Rainfall: 230, Temperature: 33, Population_Growth: 1.6, Water_Availability: 4100 },
        { City: 'Kolkata', Rainfall: 160, Temperature: 31, Population_Growth: 1.4, Water_Availability: 3900 },
        { City: 'Pune', Rainfall: 210, Temperature: 29, Population_Growth: 1.3, Water_Availability: 4050 },
        { City: 'Ahmedabad', Rainfall: 140, Temperature: 36, Population_Growth: 2.1, Water_Availability: 3450 },
        { City: 'Jaipur', Rainfall: 130, Temperature: 34, Population_Growth: 2.3, Water_Availability: 3300 },
        { City: 'Lucknow', Rainfall: 190, Temperature: 30, Population_Growth: 1.9, Water_Availability: 4000 }
      ];
    }
  
    function loadSampleData() {
      fetch('/get_data')
      .then(response => response.json())
      .then(data => {
        if (data && data.length > 0) {
          sampleData = data;
          populateTable(data);
        } else {
          sampleData = getFallbackData();
          populateTable(sampleData);
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        sampleData = getFallbackData();
        populateTable(sampleData);
      });
    }
  
    function predictWater() {
      const city = document.getElementById('city').value;
      const cityData = sampleData.find(item => item.City === city);
      if (cityData) {
        document.getElementById('predictionResult').innerText =
          `Predicted water availability for ${city} is ${cityData.Water_Availability} liters.`;
      } else {
        document.getElementById('predictionResult').innerText =
          `No prediction available for ${city}.`;
      }
    }
  
    document.addEventListener('DOMContentLoaded', function () {
      const paymentForm = document.getElementById('paymentForm');
      if (paymentForm) {
        paymentForm.addEventListener('submit', function (event) {
          event.preventDefault();
          const liters = parseFloat(document.getElementById('liters').value);
          const distance = parseFloat(document.getElementById('distance').value);
          if (isNaN(liters) || isNaN(distance) || liters <= 0 || distance < 0) {
            alert('Please enter valid values for liters and distance.');
            return;
          }
          const ratePerLiter = 10; // rupees per liter
          const waterCost = liters * ratePerLiter;
          const distanceCost = (liters / 2) * distance * 0.1; // for every km, for every 2 liters add 0.1 rupees
          const totalPayment = waterCost + distanceCost;
          document.getElementById('paymentAmount').textContent = `₹${totalPayment.toFixed(2)}`;
          document.getElementById('payButton').style.display = 'inline-block';
          document.getElementById('payButton').onclick = function () {
            initiatePayment(totalPayment);
          };
        });
      }
  
      function initiatePayment(amount) {
        const options = {
          key: 'YOUR_RAZORPAY_KEY', // Replace with your Razorpay Key
          amount: amount * 100, // in paise
          currency: 'INR',
          name: 'Sample Cost Payment',
          description: 'Payment for water sample cost',
          theme: { color: '#4CAF50' },
          handler: function (response) {
            alert('Payment successful! Payment ID: ' + response.razorpay_payment_id);
          },
          prefill: {
            name: 'Customer Name',
            email: 'customer@example.com',
            contact: '1234567890'
          }
        };
        const rzp1 = new Razorpay(options);
        rzp1.open();
      }
  
      loadSampleData();
    });
  
    /* ================================
       Route Tracker Code
    ================================ */
    let map, truckMarker, destinationMarker, routeLayer;
    const openRouteServiceApiKey = "5b3ce3597851110001cf6248aeab9a7ff629446ca97fdb891cc8bb1c"; // Replace with your API key
    const nominatimApiUrl = "https://nominatim.openstreetmap.org/search?format=json&q=";

    function initMap() {
      map = L.map('map').setView([19.0760, 72.8777], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      trackTruckLocation();
    }

    function trackTruckLocation() {
      if (navigator.geolocation) {
          navigator.geolocation.watchPosition(
              (position) => {
                  const truckLocation = [position.coords.latitude, position.coords.longitude];
                  if (!truckMarker) {
                      truckMarker = L.marker(truckLocation, { title: "Truck's Location" }).addTo(map);
                  } else {
                      truckMarker.setLatLng(truckLocation);
                  }
                  map.setView(truckLocation, 14);
                  document.getElementById("status").innerText = `Truck Location: ${truckLocation[0].toFixed(5)}, ${truckLocation[1].toFixed(5)}`;
                  if (destinationMarker) {
                      updateRoute(truckLocation, destinationMarker.getLatLng());
                  }
              },
              (error) => {
                  console.error("Error fetching location:", error);
                  document.getElementById("status").innerText = "Error fetching location.";
              },
              { enableHighAccuracy: true }
          );
      } else {
          document.getElementById("status").innerText = "Geolocation not supported by this browser.";
      }
    }

    function setDestination() {
      const destinationName = document.getElementById("destination").value;
      if (!destinationName) {
          alert("Please enter a destination name.");
          return;
      }
      fetch(nominatimApiUrl + encodeURIComponent(destinationName))
          .then(response => response.json())
          .then(data => {
              if (data.length === 0) {
                  alert("Destination not found. Try again.");
                  return;
              }
              const destination = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
              if (destinationMarker) map.removeLayer(destinationMarker);
              destinationMarker = L.marker(destination, { title: "Destination" }).addTo(map);
              document.getElementById("status").innerText = `Destination: ${destinationName}`;
              if (truckMarker) {
                  updateRoute(truckMarker.getLatLng(), destination);
              }
          })
          .catch(error => console.error("Error fetching destination:", error));
    }

    function updateRoute(source, destination) {
      const url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${openRouteServiceApiKey}&start=${source.lng},${source.lat}&end=${destination[1]},${destination[0]}`;
      fetch(url)
          .then(response => response.json())
          .then(data => {
              if (routeLayer) map.removeLayer(routeLayer);
              const routeCoords = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
              routeLayer = L.polyline(routeCoords, { color: 'blue', weight: 4 }).addTo(map);
              const distance = (data.routes[0].summary.distance / 1000).toFixed(2);
              document.getElementById("status").innerText += ` | Distance: ${distance} km`;
              displayDirections(data.routes[0].segments[0].steps);
          })
          .catch(error => console.error("Error fetching route:", error));
    }

    function displayDirections(steps) {
      const directionList = document.getElementById("directionList");
      directionList.innerHTML = "";
      steps.forEach((step, index) => {
          const li = document.createElement("li");
          li.innerText = `${index + 1}. ${step.instruction} (${(step.distance / 1000).toFixed(2)} km)`;
          directionList.appendChild(li);
      });
    }

    function initRouteTracker() {
      if (!map) {
          initMap();
      }
    }
  </script>
</body>
</html>